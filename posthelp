#!/usr/bin/env python3

import time
import os
import sys
import json
import re

def timestamp(): return int(time.time())

def write(pathname, what):
	with open(pathname, "w") as fp:
		fp.write(what)
	print("Wrote", pathname)

def note(*args):
	print("Type your note (ends at EOF)\n")
	content = sys.stdin.read(-1).strip()
	obj = { "cdate": timestamp(), "blurb": content }
	pathname = os.path.join(".", "posts", "notes", str(obj["cdate"]) + ".json")
	write(pathname, json.dumps(obj))

def article(*args):
	name = input("File name > ").strip()
	title = input("Title > ").strip()
	blurb = input("Blurb > ").strip()
	print("Body (ends at EOF)\n")
	body = sys.stdin.read(-1).strip()
	pathname = os.path.join(".", "posts", "articles", re.sub(r".html$", ".json", name))
	obj = { "title": title, "blurb": blurb, "body": body, "cdate": timestamp() }
	write(pathname, json.dumps(obj))

def main():
	FNS = {"a": article, "n": note}
	answer = ""
	while True:
		answer = input("Select post type:\n\t(n)ote\n\t(a)rticle\n> ")
		if answer in ("n", "a"): break
	return FNS[answer.strip()](sys.argv[1:])

if __name__ == "__main__":
	sys.exit(main())
