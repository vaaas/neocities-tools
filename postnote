#!/usr/bin/env python3

import time
import os
import sys
import lxml.etree as ET

timestamp = int(time.time())
now = time.gmtime(timestamp)

def E (tag, attrs={}, children=[], text=""):
	elem = ET.Element(tag, attrs)
	for child in children: elem.append(child)
	if (text): elem.text = text
	return elem

tree = E("html",
	children=[
		E("head", children=[
			E("meta", attrs={"name": "timestamp", "value": str(timestamp)}),
			E("meta", attrs={"name": "type", "value": "note"})]),
		ET.fromstring("<body>%s</body>" % (sys.stdin.read(),)) ])
tgtfile = os.path.join("posts", "notes", str(timestamp) + ".html")

with open(tgtfile, "w") as f:
	f.write("<!DOCTYPE html>")
	f.write(ET.tostring(tree, encoding="unicode"))
	print("Wrote", tgtfile)
