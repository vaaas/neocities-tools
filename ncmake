#!/usr/bin/make -f
DIR = render
ARTICLES = $(addprefix $(DIR)/,$(wildcard articles/*.html))
NOTES = $(addprefix $(DIR)/,$(addsuffix .html,$(sort $(wildcard notes/*))))
.PHONY: all dirs

all: dirs $(DIR)/rss.xml $(DIR)/index.html $(DIR)/articles/index.html

dirs:
	mkdir -p $(DIR) $(DIR)/articles $(DIR)/notes

$(DIR)/rss.xml: $(DIR)/index.html
	./ncrender rss $^ > $@

$(DIR)/index.html: $(DIR)/articles/index.html $(firstword $(NOTES))
	./ncrender index $^ > $@

$(DIR)/articles/index.html: $(ARTICLES)
	./ncrender articleindex $(^:$(DIR)/%=%) > $@

$(DIR)/articles/%: ./articles/%
	./ncrender article $^ > $@

$(DIR)/notes/index.html: $(NOTES)
	./ncrender notesindex $(^:$(DIR)/%.html=%) > $@

$(DIR)/notes/%.html: ./notes/%
	./ncrender notes $^ > $@
