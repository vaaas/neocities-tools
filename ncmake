#!/usr/bin/make -f
TARGET = render
DIRS = $(shell find ./ -maxdepth 1 -xtype d -not -name "render" -not -name "."| cut -c 3-)
TGTDIRS = $(addprefix $(TARGET)/,$(DIRS))
TGTFILES = $(addprefix $(TARGET)/,$(wildcard $(DIRS)/*.html))
INDICES = $(addsuffix /index.html,$(TGTDIRS))
.PHONY: all dirs test

all: dirs $(TARGET)/index.html $(TARGET)/rss.xml $(TGTFILES)

dirs:
	mkdir -p $(TARGET) $(TGTDIRS)

$(TARGET)/index.html: $(INDICES)
	./ncrender compile $^ > $@

%/rss.xml: %/index.html
	./ncrender rss $^ > $@

$(TARGET)/%/index.html: %/*.html
	./ncrender index $^ > $@

$(TARGET)/%.html: %.html
	./ncrender item $^ > $@
